<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SpellRightPro â€“ Complete Your Purchase</title>

  <!-- Styles -->
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="icon" href="/assets/logo.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    .payment-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .payment-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin: 20px 0;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      border: 1px solid #e7e7e7;
    }

    .plan-summary {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      text-align: center;
    }

    .plan-name {
      font-size: 1.5em;
      font-weight: bold;
      color: #7b2ff7;
      margin-bottom: 10px;
    }

    .plan-price {
      font-size: 2.5em;
      font-weight: bold;
      color: #28a745;
    }

    .plan-period {
      color: #666;
      font-size: 1.1em;
    }

    .payment-form {
      display: grid;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .form-input {
      padding: 12px 15px;
      border: 2px solid #e7e7e7;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #7b2ff7;
    }

    .security-features {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .security-features i {
      color: #28a745;
      font-size: 1.2em;
    }

    .payment-methods {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }

    .payment-method {
      border: 2px solid #e7e7e7;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
    }

    .payment-method.selected {
      border-color: #7b2ff7;
      background: rgba(123, 47, 247, 0.05);
    }

    .payment-method i {
      font-size: 2em;
      margin-bottom: 10px;
      color: #666;
    }

    .payment-method.selected i {
      color: #7b2ff7;
    }

    .pay-button {
      background: #28a745;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.2em;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
      margin-top: 20px;
    }

    .pay-button:hover {
      background: #218838;
    }

    .pay-button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    .loading-spinner {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .loading-spinner i {
      font-size: 2em;
      color: #7b2ff7;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .logo {
      height: 40px;
      width: auto;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand span {
      font-size: 1.5rem;
      font-weight: bold;
      color: #7b2ff7;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: #7b2ff7;
      text-decoration: none;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .error-message {
      color: #dc3545;
      font-size: 0.9em;
      margin-top: 5px;
      display: none;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      margin: 20px 0;
      display: none;
    }
  </style>
</head>

<body>
  <div class="container fade-in">
    <!-- ===== NAVBAR ===== -->
    <nav class="navbar">
      <div class="brand">
        <img src="/assets/logo.png" alt="Logo" class="logo" />
        <span>SpellRightPro</span>
      </div>
      <div class="nav-actions">
        <a href="/index.html" class="btn-secondary"><i class="fa fa-home"></i> Home</a>
        <a href="/premium.html" class="premium-button">
          <i class="fa fa-crown"></i> Premium
        </a>
      </div>
    </nav>

    <div class="payment-container">
      <!-- Back to Pricing Link -->
      <a href="/pricing.html" class="back-link">
        <i class="fa fa-arrow-left"></i> Back to Pricing
      </a>

      <div class="payment-card">
        <h1 class="card-title" style="text-align: center; margin-bottom: 10px;">
          <i class="fa fa-credit-card"></i> Complete Your Purchase
        </h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
          Secure payment processed through Stripe
        </p>

        <!-- Plan Summary -->
        <div class="plan-summary">
          <div class="plan-name" id="planName">Premium Monthly Plan</div>
          <div class="plan-price" id="planPrice">CAD $4.99</div>
          <div class="plan-period" id="planPeriod">per month</div>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
          <i class="fa fa-check-circle"></i> Payment successful! Redirecting to your premium dashboard...
        </div>

        <!-- Payment Form -->
        <form id="paymentForm" class="payment-form">
          <!-- Payment Method Selection -->
          <div class="form-group">
            <label>Payment Method</label>
            <div class="payment-methods">
              <div class="payment-method selected" data-method="card" onclick="selectPaymentMethod('card')">
                <i class="fa fa-credit-card"></i>
                <div>Credit Card</div>
              </div>
              <div class="payment-method" data-method="paypal" onclick="selectPaymentMethod('paypal')">
                <i class="fab fa-paypal"></i>
                <div>PayPal</div>
              </div>
            </div>
          </div>

          <!-- Card Payment Form (shown by default) -->
          <div id="cardPaymentForm">
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <input type="text" id="cardNumber" class="form-input" placeholder="1234 5678 9012 3456" maxlength="19">
              <div class="error-message" id="cardNumberError">Please enter a valid card number</div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input type="text" id="expiryDate" class="form-input" placeholder="MM/YY" maxlength="5">
                <div class="error-message" id="expiryDateError">Please enter a valid expiry date</div>
              </div>
              <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="text" id="cvv" class="form-input" placeholder="123" maxlength="4">
                <div class="error-message" id="cvvError">Please enter a valid CVV</div>
              </div>
            </div>

            <div class="form-group">
              <label for="cardName">Name on Card</label>
              <input type="text" id="cardName" class="form-input" placeholder="John Doe">
              <div class="error-message" id="cardNameError">Please enter the name on your card</div>
            </div>
          </div>

          <!-- PayPal Payment Form (hidden by default) -->
          <div id="paypalPaymentForm" style="display: none;">
            <div class="form-group">
              <p style="text-align: center; color: #666; padding: 20px;">
                You will be redirected to PayPal to complete your payment securely.
              </p>
            </div>
          </div>

          <!-- Billing Address -->
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" class="form-input" placeholder="your@email.com">
            <div class="error-message" id="emailError">Please enter a valid email address</div>
          </div>

          <div class="form-group">
            <label for="country">Country</label>
            <select id="country" class="form-input">
              <option value="">Select Country</option>
              <option value="CA" selected>Canada</option>
              <option value="US">United States</option>
              <option value="GB">United Kingdom</option>
              <option value="AU">Australia</option>
              <option value="IN">India</option>
            </select>
            <div class="error-message" id="countryError">Please select your country</div>
          </div>

          <!-- Security Features -->
          <div class="security-features">
            <i class="fa fa-shield-alt"></i>
            <span>Your payment is secure and encrypted</span>
            <i class="fa fa-lock"></i>
            <span>We never store your card details</span>
          </div>

          <!-- Loading Spinner -->
          <div class="loading-spinner" id="loadingSpinner">
            <i class="fa fa-spinner"></i>
            <p>Processing your payment...</p>
          </div>

          <!-- Pay Button -->
          <button type="submit" class="pay-button" id="payButton">
            <i class="fa fa-lock"></i> Pay Now - <span id="payAmount">CAD $4.99</span>
          </button>

          <!-- Terms Agreement -->
          <div style="text-align: center; margin-top: 20px;">
            <small style="color: #666;">
              By completing this purchase, you agree to our 
              <a href="/terms.html" style="color: #7b2ff7;">Terms of Service</a> and 
              <a href="/privacy.html" style="color: #7b2ff7;">Privacy Policy</a>
            </small>
          </div>
        </form>
      </div>

      <!-- Guarantee Section -->
      <div style="text-align: center; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
        <h4><i class="fa fa-shield-alt"></i> 48-Hour Money-Back Guarantee</h4>
        <p style="color: #666; margin: 10px 0;">
          If you're not satisfied with Premium, we'll refund your payment within 48 hours.
        </p>
        <small style="color: #999;">
          <a href="/refund-policy.html" style="color: #7b2ff7;">View refund policy</a>
        </small>
      </div>
    </div>

    <!-- ===== FOOTER ===== -->
    <footer class="text-center mt-4" style="padding: 30px 0; border-top: 1px solid #e7e7e7;">
      <p>
        <a href="/terms.html">Terms</a> Â·
        <a href="/privacy.html">Privacy</a> Â·
        <a href="/refund-policy.html">Refund Policy</a> Â·
        <a href="/contact.html">Contact</a>
      </p>
      <p style="font-size: 0.8rem; color: gray;">Â© 2025 SpellRightPro</p>
    </footer>
  </div>

  <!-- ===== PAYMENT PROCESSING SCRIPT ===== -->
  <script>
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const planType = urlParams.get('plan') || localStorage.getItem('selectedPlan') || 'monthly';
    const planPrice = urlParams.get('price') || localStorage.getItem('selectedPlanPrice') || '4.99';
    const currency = urlParams.get('currency') || localStorage.getItem('selectedPlanCurrency') || 'CAD';

    // Store plan details for later use
    localStorage.setItem('selectedPlan', planType);
    localStorage.setItem('selectedPlanPrice', planPrice);
    localStorage.setItem('selectedPlanCurrency', currency);

    // Update UI with plan details
    document.getElementById('planName').textContent = `Premium ${planType === 'monthly' ? 'Monthly' : 'Annual'} Plan`;
    document.getElementById('planPrice').textContent = `${currency} $${planPrice}`;
    document.getElementById('planPeriod').textContent = planType === 'monthly' ? 'per month' : 'per year';
    document.getElementById('payAmount').textContent = `${currency} $${planPrice}`;

    let selectedPaymentMethod = 'card';

    function selectPaymentMethod(method) {
      selectedPaymentMethod = method;
      
      // Update UI
      document.querySelectorAll('.payment-method').forEach(el => {
        el.classList.remove('selected');
      });
      document.querySelector(`[data-method="${method}"]`).classList.add('selected');
      
      // Show/hide forms
      if (method === 'card') {
        document.getElementById('cardPaymentForm').style.display = 'block';
        document.getElementById('paypalPaymentForm').style.display = 'none';
      } else {
        document.getElementById('cardPaymentForm').style.display = 'none';
        document.getElementById('paypalPaymentForm').style.display = 'block';
      }
    }

    // Form validation
    function validateForm() {
      let isValid = true;
      
      // Clear previous errors
      document.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
      });

      // Email validation
      const email = document.getElementById('email').value;
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        document.getElementById('emailError').style.display = 'block';
        isValid = false;
      }

      // Country validation
      const country = document.getElementById('country').value;
      if (!country) {
        document.getElementById('countryError').style.display = 'block';
        isValid = false;
      }

      // Card validation (if card payment)
      if (selectedPaymentMethod === 'card') {
        const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
        if (!cardNumber || cardNumber.length < 13) {
          document.getElementById('cardNumberError').style.display = 'block';
          isValid = false;
        }

        const expiryDate = document.getElementById('expiryDate').value;
        if (!expiryDate || !/^\d{2}\/\d{2}$/.test(expiryDate)) {
          document.getElementById('expiryDateError').style.display = 'block';
          isValid = false;
        }

        const cvv = document.getElementById('cvv').value;
        if (!cvv || cvv.length < 3) {
          document.getElementById('cvvError').style.display = 'block';
          isValid = false;
        }

        const cardName = document.getElementById('cardName').value;
        if (!cardName) {
          document.getElementById('cardNameError').style.display = 'block';
          isValid = false;
        }
      }

      return isValid;
    }

    // Simulate payment processing
    function processPayment() {
      const loadingSpinner = document.getElementById('loadingSpinner');
      const payButton = document.getElementById('payButton');
      const successMessage = document.getElementById('successMessage');
      const paymentForm = document.getElementById('paymentForm');

      // Show loading
      loadingSpinner.style.display = 'block';
      payButton.disabled = true;

      // Simulate API call to payment processor
      setTimeout(() => {
        // In a real application, this would be an API call to Stripe/PayPal
        console.log('Processing payment...', {
          plan: planType,
          price: planPrice,
          currency: currency,
          method: selectedPaymentMethod
        });

        // Simulate successful payment
        loadingSpinner.style.display = 'none';
        paymentForm.style.display = 'none';
        successMessage.style.display = 'block';

        // Activate premium access
        activatePremiumAccess();

        // Redirect to premium page after delay
        setTimeout(() => {
          window.location.href = '/premium.html?payment=success';
        }, 3000);

      }, 2000); // Simulate 2 second processing time
    }

    // Activate premium access for the user
    function activatePremiumAccess() {
      // Get current user (in real app, this would be from Firebase auth)
      const userEmail = document.getElementById('email').value;
      
      // Store premium status in localStorage (in real app, this would be in Firebase)
      const premiumData = {
        plan: planType,
        price: planPrice,
        currency: currency,
        activatedAt: new Date().toISOString(),
        expiryDate: planType === 'monthly' 
          ? new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString() // 30 days
          : new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(), // 365 days
        active: true
      };

      localStorage.setItem('premiumUser', JSON.stringify(premiumData));
      localStorage.setItem('userEmail', userEmail);
      
      console.log('Premium access activated:', premiumData);
    }

    // Form submission
    document.getElementById('paymentForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (validateForm()) {
        processPayment();
      }
    });

    // Input formatting
    document.getElementById('cardNumber').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\s/g, '');
      if (value.length > 0) {
        value = value.match(new RegExp('.{1,4}', 'g')).join(' ');
      }
      e.target.value = value;
    });

    document.getElementById('expiryDate').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length >= 2) {
        value = value.substring(0, 2) + '/' + value.substring(2, 4);
      }
      e.target.value = value;
    });

    // Check if user is coming back from successful payment
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('payment') === 'success') {
        document.getElementById('successMessage').style.display = 'block';
        document.getElementById('paymentForm').style.display = 'none';
        
        setTimeout(() => {
          window.location.href = '/premium.html';
        }, 2000);
      }
    });
  </script>
</body>
</html>
