<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SpellRightPro — Spelling Bee (Freemium)</title>

  <link rel="preload" href="/assets/logo.png" as="image"/>
  <link rel="stylesheet" href="/css/styles.css"/>
  <script src="/js/config.js"></script>
</head>
<body>
  <header>
    <div class="brand">
      <img src="/assets/logo.png" alt="SpellRightPro"/>
      <strong>SpellRightPro <span style="opacity:.8">Bee</span></strong>
    </div>
    <div class="nav">
      <button class="btn-premium" onclick="location.href='/index.html'"><i class="fa fa-home"></i>Home</button>
      <button id="dark-mode-toggle" class="btn-premium" aria-label="Toggle Dark Mode">
      <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <main class="main-card">
    <h2>Spelling Bee (Freemium)</h2>
    <p class="subtitle">Listen carefully and spell aloud. Your pronunciation will be checked automatically.</p>

    <textarea id="customWords" placeholder="Paste custom list (optional)…"></textarea>
    <div class="row">
      <input id="fileInput" type="file" accept=".txt,.csv"/>
      <button id="useCustom" class="btn-secondary">Use Custom</button>
    </div>

    <div class="row">
      <button id="btnStart" class="start">Start</button>
      <button id="btnSayAgain">Say Again</button>
      <button id="btnFlag">Flag</button>
      <button id="btnEnd">End</button>
    </div>

    <div id="wordProgress"></div>
    <div id="feedback"></div>
    <div id="summary" hidden></div>

    <div id="ads" class="ads"></div>
  </main>

  <script>
  // Dark mode unified
  (function(){
    const key='dark',toggle=document.getElementById('darkToggle');
    const apply=()=>{
      const enabled=localStorage.getItem(key)==='1';
      document.body.classList.toggle('dark-mode',enabled);
      toggle.innerHTML=enabled?'<i class="fa fa-sun"></i>':'<i class="fa fa-moon"></i>';
    };
    toggle.addEventListener('click',()=>{localStorage.setItem(key,localStorage.getItem(key)==='1'?'0':'1');apply();});
    apply();
  })();

  // Ads
  (function(){
    if(!window.AD_CLIENT)return;
    const s=document.createElement('script');
    s.async=true;
    s.src=`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${window.AD_CLIENT}`;
    s.crossOrigin="anonymous";document.head.appendChild(s);
    const ins=document.createElement('ins');
    ins.className='adsbygoogle';ins.style.cssText='display:block;min-height:90px';
    ins.setAttribute('data-ad-format','auto');
    ins.setAttribute('data-full-width-responsive','true');
    document.getElementById('ads').appendChild(ins);
    (window.adsbygoogle=window.adsbygoogle||[]).push({});
  })();

  // Bee Trainer
  (function(){
    const E=id=>document.getElementById(id);
    const els={txt:E('customWords'),file:E('fileInput'),use:E('useCustom'),start:E('btnStart'),say:E('btnSayAgain'),flag:E('btnFlag'),end:E('btnEnd'),progress:E('wordProgress'),feedback:E('feedback'),summary:E('summary')};
    const st={words:[],i:0,flags:new Set(),correct:[],incorrect:[],active:false};
    function normalize(s){return(s||'').toLowerCase().replace(/[^\p{L}]+/gu,'');}
    function speak(w){return new Promise(res=>{if(!('speechSynthesis'in window))return res();const u=new SpeechSynthesisUtterance(w);u.rate=.95;const v=speechSynthesis.getVoices().find(v=>/^en[-_]/i.test(v.lang));if(v)u.voice=v;u.onend=res;speechSynthesis.cancel();speechSynthesis.speak(u);});}
    async function loadDefault(){try{const r=await fetch('/data/word-lists/spelling-bee.json',{cache:'no-store'});const j=await r.json();return Array.isArray(j?.words)?j.words:j;}catch(e){}return ['accommodate','rhythm','necessary','recommend','privilege'];}
    async function buildList(){const t=(els.txt.value||'').split(/[\n,]+/).map(s=>s.trim()).filter(Boolean);if(t.length)return t;if(els.file.files[0]){const text=await els.file.files[0].text();return text.split(/[\n,]+/).map(s=>s.trim()).filter(Boolean);}return await loadDefault();}
    async function play(){const w=st.words[st.i];if(!w)return;els.feedback.textContent='🎧 Listen carefully…';await speak(w);await mark(w);}
    function next(){if(st.i<st.words.length-1){st.i++;play();}else end();}
    function end(){st.active=false;const f=[...st.flags];els.summary.innerHTML=`<strong>Session complete</strong><br>Correct: ${st.correct.length} • Incorrect: ${st.incorrect.length}<br>${f.length?('Flagged: '+f.join(', ')):'No flagged words'}`;els.summary.hidden=false;}
    function mark(target){const rec=new(window.SpeechRecognition||window.webkitSpeechRecognition)();if(!rec){els.feedback.textContent='⚠️ No speech recognition support.';return;}rec.lang='en-US';rec.onresult=e=>{const said=e.results[0][0].transcript;const ok=normalize(said)===normalize(target);if(ok){st.correct.push(target);els.feedback.textContent='✅ Correct';}else{st.incorrect.push(target);els.feedback.textContent=`❌ Incorrect — ${target}`;}setTimeout(next,800);};rec.start();}
    els.start.addEventListener('click',async()=>{if(st.active)return;st.words=await buildList();if(!st.words.length){els.feedback.textContent='No words available.';return;}st.i=0;st.flags.clear();st.correct=[];st.incorrect=[];st.active=true;els.summary.hidden=true;play();});
    els.say.addEventListener('click',()=>{if(!st.active)return;speak(st.words[st.i]);});
    els.flag.addEventListener('click',()=>{if(!st.active)return;const w=st.words[st.i];st.flags.has(w)?st.flags.delete(w):st.flags.add(w);els.feedback.textContent=`🚩 Flagged “${w}”`;});
    els.end.addEventListener('click',end);
    els.use.addEventListener('click',()=>alert('Custom list ready.'));
  })();
  </script>
</body>
</html>
